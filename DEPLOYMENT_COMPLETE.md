# ë°°í¬ ì™„ë£Œ ë³´ê³ ì„œ

> **ë‚ ì§œ**: 2025-10-28  
> **ì‘ì—…ì**: AI Assistant  
> **í”„ë¡œì íŠ¸**: hub-verdi (ì •ëŒ€í‘œì˜ ì˜¤í† í”Œëœ)

---

## âœ… ì™„ë£Œëœ ì‘ì—…

### 1. ê¸´ê¸‰ ì¡°ì¹˜: í¬íŠ¸ ì¶©ëŒ í•´ê²°

#### ë¬¸ì œ
- `hub-verdi-api` ìƒíƒœ: **errored** (15íšŒ ì¬ì‹œì‘ ì‹¤íŒ¨)
- ì˜¤ë¥˜: `EADDRINUSE: address already in use :::4000`
- ì›ì¸: PID 1590534ê°€ í¬íŠ¸ 4000 ì ìœ 

#### í•´ê²°
```bash
âœ… sudo kill 1590534
âœ… pm2 delete hub-verdi-api
âœ… pm2 start ecosystem.config.js
âœ… pm2 save
```

#### ê²°ê³¼
- **hub-verdi-api**: online (PID: 3481439)
- **Uptime**: 3ë¶„+
- **ì¬ì‹œì‘ íšŸìˆ˜**: 1íšŒ (ì •ìƒ)
- **ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰**: 64.0mb

---

### 2. GitHub Actions ë°°í¬ ìˆ˜ì •

#### ë¬¸ì œ
```bash
npm: command not found
node: No such file or directory
Exit code: 127
```

**ì›ì¸**: SSH ì›ê²© ëª…ë ¹ ì‹¤í–‰ ì‹œ NVM í™˜ê²½ ë¯¸ë¡œë“œ

#### í•´ê²°: `.github/workflows/deploy.yml` ìˆ˜ì •

**ë³€ê²½ ì „**:
```yaml
ssh -i ~/.ssh/id_rsa ubuntu@${{ secrets.HOST_IP }} "
  cd /var/www/autoplan-api
  npm install                    # â† npmì„ ì°¾ì„ ìˆ˜ ì—†ìŒ
  pm2 restart hub-verdi-api
"
```

**ë³€ê²½ í›„**:
```yaml
ssh -i ~/.ssh/id_rsa ubuntu@${{ secrets.HOST_IP }} "
  # NVM í™˜ê²½ ë¡œë“œ
  export NVM_DIR=\"\$HOME/.nvm\"
  [ -s \"\$NVM_DIR/nvm.sh\" ] && . \"\$NVM_DIR/nvm.sh\"
  
  cd /var/www/autoplan-api
  
  # ë²„ì „ í™•ì¸
  echo \"Node version: \$(node -v)\"
  echo \"NPM version: \$(npm -v)\"
  
  # ì˜ì¡´ì„± ì„¤ì¹˜
  npm install --production
  
  # PM2 ì¬ì‹œì‘
  pm2 restart hub-verdi-api || pm2 start ecosystem.config.js
  pm2 save
"
```

#### ì¶”ê°€ ê°œì„ 
- **í—¬ìŠ¤ì²´í¬ ë‹¨ê³„ ì¶”ê°€**
```yaml
- name: Health check
  run: |
    echo "Waiting for API to start..."
    sleep 5
    curl -f https://autoplan.hyoda.kr/api/health || exit 1
    echo "âœ… API deployment successful!"
```

---

### 3. ecosystem.config.js ê°œì„ 

#### ì¶”ê°€ëœ ì˜µì…˜
```javascript
cwd: '/var/www/autoplan-api',    // ì‘ì—… ë””ë ‰í† ë¦¬ ëª…ì‹œ
autorestart: true,                 // ìë™ ì¬ì‹œì‘ í™œì„±í™”
max_memory_restart: '500M',        // ë©”ëª¨ë¦¬ 500MB ì´ˆê³¼ ì‹œ ì¬ì‹œì‘
```

#### ë¹„êµ: ë‹¤ë¥¸ í”„ë¡œì íŠ¸ ì°¸ê³ 
- **miracle-homepage**: `npm start` ì‚¬ìš©
- **hyoda-place**: cluster ëª¨ë“œ (2 ì¸ìŠ¤í„´ìŠ¤)
- **hub-verdi-api**: fork ëª¨ë“œ (1 ì¸ìŠ¤í„´ìŠ¤) - íŠ¸ë˜í”½ ê³ ë ¤

---

### 4. ë°°í¬ ë¬¸ì„œ ì‘ì„±

#### ìƒì„±ëœ ë¬¸ì„œ
1. **DEPLOYMENT.md** (ì™„ì „í•œ ë°°í¬ ê°€ì´ë“œ)
   - í”„ë¡œì íŠ¸ êµ¬ì¡°
   - ë°°í¬ ë°©ì‹ (GitHub Actions vs ì›¹í›…)
   - ë°°í¬ ì ˆì°¨ (ì •ì  ì‚¬ì´íŠ¸ + API)
   - íŠ¸ëŸ¬ë¸”ìŠˆíŒ… (4ê°€ì§€ ì£¼ìš” ë¬¸ì œ)
   - ëª¨ë‹ˆí„°ë§ (PM2, ë¡œê·¸, í—¬ìŠ¤ì²´í¬)
   - ê¸´ê¸‰ ëŒ€ì‘ ê°€ì´ë“œ

2. **README.md** (í”„ë¡œì íŠ¸ ê°œìš”)
   - í”„ë¡œì íŠ¸ ì†Œê°œ ë° íŠ¹ì§•
   - ê¸°ìˆ  ìŠ¤íƒ
   - ì„¤ì¹˜/ì‹¤í–‰/ë°°í¬ ê°€ì´ë“œ ë§í¬
   - íŠ¸ëŸ¬ë¸”ìŠˆíŒ… ë¹ ë¥¸ ì°¸ì¡°
   - ì„±ëŠ¥ ì§€í‘œ

3. **DEPLOYMENT_COMPLETE.md** (ë³¸ ë¬¸ì„œ)
   - ì™„ë£Œëœ ì‘ì—… ìš”ì•½
   - ë°°í¬ ì „í›„ ë¹„êµ
   - ê²€ì¦ ê²°ê³¼

---

## ğŸ” ê²€ì¦ ê²°ê³¼

### API í—¬ìŠ¤ì²´í¬
```bash
$ curl https://autoplan.hyoda.kr/api/health
{
  "status": "OK",
  "timestamp": "2025-10-28T01:53:03.104Z"
}
```
âœ… **ì •ìƒ ë™ì‘**

### PM2 ìƒíƒœ
```
â”Œâ”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ id â”‚ name          â”‚ version â”‚ mode    â”‚ uptime â”‚ â†º    â”‚ status    â”‚
â”œâ”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 72 â”‚ hub-verdi-api â”‚ 1.0.0   â”‚ fork    â”‚ 3m     â”‚ 1    â”‚ online    â”‚
â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```
âœ… **online ìƒíƒœ**

### ì„œë²„ í™˜ê²½
```bash
Node.js: v22.19.0
NPM: 10.9.3
PM2: 5.x
NVM: /home/ubuntu/.nvm/
```
âœ… **ì •ìƒ ì„¤ì •**

### Git ì»¤ë°‹ ì´ë ¥
```bash
7bf334b - ë¬¸ì„œ: README.md ì¶”ê°€
f403e5b - ë¬¸ì„œ: ë°°í¬ ê°€ì´ë“œ ë° í—¬ìŠ¤ì²´í¬ ì¶”ê°€
f42148d - ë°°í¬: GitHub Actions NVM í™˜ê²½ ë¡œë“œ ë° ecosystem ê°œì„ 
```
âœ… **3ê°œ ì»¤ë°‹ ì™„ë£Œ**

---

## ğŸ“Š ë°°í¬ ì „í›„ ë¹„êµ

| í•­ëª© | ë°°í¬ ì „ | ë°°í¬ í›„ |
|------|---------|---------|
| **API ìƒíƒœ** | errored (15 restarts) | online âœ… |
| **í¬íŠ¸ ì¶©ëŒ** | PID 1590534 ì ìœ  | í•´ê²° âœ… |
| **GitHub Actions** | npm: command not found | ì •ìƒ ë°°í¬ âœ… |
| **NVM í™˜ê²½** | ë¯¸ë¡œë“œ | ë¡œë“œë¨ âœ… |
| **í—¬ìŠ¤ì²´í¬** | ì‹¤íŒ¨ | ì •ìƒ âœ… |
| **ecosystem.config.js** | ê¸°ë³¸ ì„¤ì • | ê°œì„ ë¨ âœ… |
| **ë°°í¬ ë¬¸ì„œ** | ì—†ìŒ | DEPLOYMENT.md âœ… |
| **í”„ë¡œì íŠ¸ ë¬¸ì„œ** | ì—†ìŒ | README.md âœ… |

---

## ğŸ¯ ì£¼ìš” ê°œì„ ì‚¬í•­

### 1. ì•ˆì •ì„±
- âœ… í¬íŠ¸ ì¶©ëŒ í•´ê²° ë©”ì»¤ë‹ˆì¦˜
- âœ… PM2 ìë™ ì¬ì‹œì‘ ì„¤ì •
- âœ… ë©”ëª¨ë¦¬ ì œí•œ (500MB)

### 2. ë°°í¬
- âœ… NVM í™˜ê²½ ìë™ ë¡œë“œ
- âœ… ë°°í¬ í›„ í—¬ìŠ¤ì²´í¬
- âœ… ì‹¤íŒ¨ ì‹œ Exit Code 1

### 3. ë¬¸ì„œí™”
- âœ… ì™„ì „í•œ ë°°í¬ ê°€ì´ë“œ
- âœ… íŠ¸ëŸ¬ë¸”ìŠˆíŒ… 4ê°€ì§€
- âœ… ê¸´ê¸‰ ëŒ€ì‘ ì ˆì°¨

### 4. ëª¨ë‹ˆí„°ë§
- âœ… PM2 ìƒíƒœ í™•ì¸ ëª…ë ¹ì–´
- âœ… ë¡œê·¸ í™•ì¸ ë°©ë²•
- âœ… API í—¬ìŠ¤ì²´í¬

---

## ğŸš€ ë‹¤ìŒ ë°°í¬ ì‹œ ì°¸ê³ ì‚¬í•­

### ì¼ë°˜ ë°°í¬
```bash
# 1. ì½”ë“œ ìˆ˜ì • í›„ ì»¤ë°‹
git add .
git commit -m "ë³€ê²½ ë‚´ìš©"

# 2. í‘¸ì‹œ (ìë™ ë°°í¬)
git push origin main

# 3. GitHub Actions í™•ì¸
# https://github.com/hyoda/hub-verdi/actions

# 4. ë°°í¬ í™•ì¸
curl https://autoplan.hyoda.kr/api/health
```

### ê¸´ê¸‰ ì¬ì‹œì‘
```bash
ssh mc-2025 "source ~/.nvm/nvm.sh && pm2 restart hub-verdi-api"
```

### í¬íŠ¸ ì¶©ëŒ í•´ê²°
```bash
# 1. í¬íŠ¸ ì‚¬ìš© í”„ë¡œì„¸ìŠ¤ í™•ì¸
ssh mc-2025 "sudo lsof -i :4000"

# 2. í”„ë¡œì„¸ìŠ¤ ì¢…ë£Œ
ssh mc-2025 "sudo kill <PID>"

# 3. API ì¬ì‹œì‘
ssh mc-2025 "source ~/.nvm/nvm.sh && pm2 restart hub-verdi-api"
```

---

## ğŸ“š ì°¸ê³  ë¬¸ì„œ

### ë°°í¬ ê´€ë ¨
- [DEPLOYMENT.md](./DEPLOYMENT.md) - ì™„ì „í•œ ë°°í¬ ê°€ì´ë“œ
- [README.md](./README.md) - í”„ë¡œì íŠ¸ ê°œìš”

### ë³´ì•ˆ ê´€ë ¨
- [SECURITY.md](./SECURITY.md) - ë³´ì•ˆ ì¡°ì¹˜ ìƒì„¸
- [api/SECURITY_QUICK_GUIDE.md](./api/SECURITY_QUICK_GUIDE.md) - ë¹ ë¥¸ ì„¤ì •

### API ê´€ë ¨
- [api/README.md](./api/README.md) - API ë¬¸ì„œ
- [api/ecosystem.config.js](./api/ecosystem.config.js) - PM2 ì„¤ì •

---

## âœ¨ ê²°ë¡ 

### ì„±ê³µì ìœ¼ë¡œ ì™„ë£Œëœ í•­ëª©
1. âœ… í¬íŠ¸ ì¶©ëŒ í•´ê²° (PID 1590534 ì¢…ë£Œ)
2. âœ… hub-verdi-api ì¬ì‹œì‘ (online ìƒíƒœ)
3. âœ… GitHub Actions ìˆ˜ì • (NVM í™˜ê²½ ë¡œë“œ)
4. âœ… ecosystem.config.js ê°œì„  (ì•ˆì •ì„± í–¥ìƒ)
5. âœ… í—¬ìŠ¤ì²´í¬ ì¶”ê°€ (ë°°í¬ ê²€ì¦)
6. âœ… ë°°í¬ ë¬¸ì„œ ì‘ì„± (DEPLOYMENT.md)
7. âœ… í”„ë¡œì íŠ¸ ë¬¸ì„œ ì‘ì„± (README.md)

### í˜„ì¬ ìƒíƒœ
```
ğŸŸ¢ hub-verdi-api: online
ğŸŸ¢ API Health: OK
ğŸŸ¢ GitHub Actions: ì •ìƒ
ğŸŸ¢ ë¬¸ì„œí™”: ì™„ë£Œ
```

### ê¶Œì¥ì‚¬í•­
- ë‹¤ìŒ ë°°í¬ë¶€í„°ëŠ” [DEPLOYMENT.md](./DEPLOYMENT.md) ì°¸ê³ 
- ë¬¸ì œ ë°œìƒ ì‹œ íŠ¸ëŸ¬ë¸”ìŠˆíŒ… ì„¹ì…˜ í™œìš©
- ì •ê¸°ì ìœ¼ë¡œ `pm2 status` ë° í—¬ìŠ¤ì²´í¬ ìˆ˜í–‰

---

**ë°°í¬ ì™„ë£Œ**: 2025-10-28 10:53 KST  
**ë‹¤ìŒ ë°°í¬ ì¤€ë¹„ ì™„ë£Œ** âœ…

